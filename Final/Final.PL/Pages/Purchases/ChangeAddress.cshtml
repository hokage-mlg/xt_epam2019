@using Final.Ioc;
@{
    Page.Title = "Change Address";
    int id = 0;
    string address = (string)Request["Address"];
    string errorMessage = null;
    string stop = null;
}
@RenderPage("~/Pages/Purchases/ChangeInfo.cshtml")
<h3 style="padding-left:40px">Change Address</h3>
@if (IsPost)
{
    if (!int.TryParse(Request["Id"], out id))
    {
        errorMessage = "Please, input your purchase id.";
    }
    else
    {
        var user = DependencyResolver.UserLogic.GetByLogin(User.Identity.Name);
        var purchases = DependencyResolver.PurchaseLogic.GetPurchasesByUserId(user.Id);
        foreach (var purchase in purchases)
        {
            stop = "false";
            if (id == purchase.Id)
            {
                if (DependencyResolver.PurchaseLogic.ChangeAddress(id, address))
                {
                    errorMessage = null;
                    <div class="alert alert-info" style="padding-left:40px">Operation was completed</div>
                }
                else
                {
                    Response.Redirect("~/404.cshtml");
                }
                stop = "true";
                break;
            }
        }
    }
}
@if (errorMessage != null || stop != "true" || stop == "false")
{
    <div class="alert alert-light" style="padding-left:40px">Please, input correct values</div>
}
<div class="main" style="padding-left:40px">
    <form action="~/Pages/Purchases/ChangeAddress.cshtml" method="post">
        <div>
            <label>Purchase Id for changes: </label>
            <input class="form-control" style="width:200px" type="text" name="Id" id="Id" />
        </div>
        <div>
            <label>New address: </label>
            <input class="form-control" style="width:200px" type="text" name="Address" id="Address" />
        </div>
        <br />
        <button class="btn btn-primary" style="width:200px">Submit</button>
    </form>
</div>
<br />
<br />